<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Skedaddle Technician Portal</title>
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- React and ReactDOM -->
    <script src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    <!-- Babel for JSX -->
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <!-- Lucide Icons -->
    <script src="https://unpkg.com/lucide@latest"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800;900&display=swap');
        body { font-family: 'Inter', sans-serif; }
        .animate-shimmer {
            background: linear-gradient(90deg, #f3f4f6 0%, #e5e7eb 50%, #f3f4f6 100%);
            background-size: 200% 100%;
            animation: shimmer 1.5s infinite;
        }
        @keyframes shimmer {
            0% { background-position: 200% 0; }
            100% { background-position: -200% 0; }
        }
    </style>
</head>
<body class="bg-slate-50">
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect } = React;
        const { 
            Clock, LogIn, LogOut, Calendar, AlertCircle, 
            CheckCircle2, History, Settings, UserCheck 
        } = lucide;

        const App = () => {
            const [user, setUser] = useState(null);
            const [status, setStatus] = useState('idle');
            const [logs, setLogs] = useState([]);
            const [error, setError] = useState(null);
            const [showHistory, setShowHistory] = useState(false);
            const [isInitializing, setIsInitializing] = useState(true);

            const LOGO_URL = "https://www.skedaddlewildlife.com/wp-content/themes/salcode-bootstrap-genesis/images/logo_r.png";
            const currentPeriod = "Dec 16 - Dec 31, 2025";
            const CLIENT_ID = "YOUR_GOOGLE_CLIENT_ID.apps.googleusercontent.com"; // REPLACE THIS

            useEffect(() => {
                const initializeGoogleAuth = () => {
                    try {
                        google.accounts.id.initialize({
                            client_id: CLIENT_ID,
                            callback: handleGoogleResponse,
                        });
                        google.accounts.id.prompt();
                        setIsInitializing(false);
                    } catch (err) {
                        console.error("Google Auth failed", err);
                        setIsInitializing(false);
                    }
                };

                const script = document.createElement('script');
                script.src = "https://accounts.google.com/gsi/client";
                script.async = true;
                script.defer = true;
                script.onload = initializeGoogleAuth;
                document.head.appendChild(script);
            }, []);

            const handleGoogleResponse = (response) => {
                const base64Url = response.credential.split('.')[1];
                const base64 = base64Url.replace(/-/g, '+').replace(/_/g, '/');
                const jsonPayload = decodeURIComponent(atob(base64).split('').map(function(c) {
                    return '%' + ('00' + c.charCodeAt(0).toString(16)).slice(-2);
                }).join(''));

                const profile = JSON.parse(jsonPayload);
                setUser({
                    email: profile.email,
                    name: profile.name,
                    picture: profile.picture
                });
                setError(null);
            };

            const handleLogout = () => {
                setUser(null);
                setLogs([]);
                setStatus('idle');
            };

            const handleClockIn = () => {
                const now = new Date();
                setLogs([{
                    type: 'IN',
                    time: now.toLocaleTimeString(),
                    date: now.toLocaleDateString()
                }, ...logs]);
                setStatus('clocked_in');
                setError(null);
            };

            const handleClockOut = () => {
                const now = new Date();
                const today = now.toLocaleDateString();
                const hasClockInToday = logs.some(log => log.type === 'IN' && log.date === today);

                if (!hasClockInToday) {
                    setError(`CRITICAL ALERT: No clock-in found for today. Automated report sent to Management regarding ${user.email}.`);
                    return;
                }

                setLogs([{
                    type: 'OUT',
                    time: now.toLocaleTimeString(),
                    date: today
                }, ...logs]);
                setStatus('clocked_out');
                setError(null);
            };

            if (isInitializing) {
                return (
                    <div className="min-h-screen flex items-center justify-center">
                        <div className="flex flex-col items-center">
                            <img src={LOGO_URL} alt="Skedaddle" className="h-16 mb-4 opacity-50" />
                            <div className="h-1 w-32 bg-slate-200 rounded-full overflow-hidden">
                                <div className="h-full bg-orange-500 w-1/2 animate-shimmer"></div>
                            </div>
                        </div>
                    </div>
                );
            }

            if (!user) {
                return (
                    <div className="min-h-screen flex items-center justify-center p-4">
                        <div className="max-w-md w-full bg-white rounded-[2rem] shadow-2xl p-10 border border-slate-200">
                            <div className="flex flex-col items-center mb-10 text-center">
                                <img src={LOGO_URL} alt="Skedaddle" className="h-20 mb-8" />
                                <h1 className="text-2xl font-black text-slate-800">Technician Portal</h1>
                                <p className="text-slate-500 text-sm mt-2">Sign in with your work email.</p>
                            </div>
                            <div className="flex justify-center">
                                <div className="g_id_signin" data-type="standard" data-shape="pill" data-size="large"></div>
                            </div>
                        </div>
                    </div>
                );
            }

            return (
                <div className="min-h-screen p-4 md:p-8">
                    <div className="max-w-2xl mx-auto">
                        <div className="flex items-center justify-between mb-8 bg-white p-4 rounded-3xl shadow-sm border border-slate-100">
                            <div className="flex items-center gap-4">
                                <img src={user.picture} className="w-12 h-12 rounded-2xl border-2 border-orange-100" />
                                <div>
                                    <p className="text-[10px] text-slate-400 font-bold uppercase tracking-widest">Technician</p>
                                    <p className="text-sm font-bold text-slate-800">{user.name}</p>
                                    <p className="text-xs text-slate-500">{user.email}</p>
                                </div>
                            </div>
                            <button onClick={handleLogout} className="p-3 text-slate-400 hover:text-red-500"><LogOut className="w-5 h-5" /></button>
                        </div>

                        <div className="bg-white rounded-[2.5rem] shadow-2xl border border-slate-100 overflow-hidden mb-6">
                            <div className="bg-slate-900 p-8 text-white flex flex-col md:flex-row justify-between gap-4">
                                <div className="flex items-start gap-4">
                                    <div className={`p-3 rounded-2xl ${status === 'clocked_in' ? 'bg-green-500 shadow-lg shadow-green-900/40' : 'bg-slate-800'}`}>
                                        <UserCheck className="w-6 h-6" />
                                    </div>
                                    <div>
                                        <p className="text-slate-400 text-[10px] font-bold uppercase tracking-[0.2em]">Payroll Period</p>
                                        <p className="text-lg font-bold text-orange-400">{currentPeriod}</p>
                                    </div>
                                </div>
                                <div className="flex flex-col md:items-end">
                                    <p className="text-slate-400 text-[10px] font-bold uppercase tracking-[0.2em]">Shift Status</p>
                                    <div className={`flex items-center gap-2 px-4 py-1.5 rounded-full font-black text-xs ${status === 'clocked_in' ? 'bg-green-500/20 text-green-400' : 'bg-slate-800 text-slate-400'}`}>
                                        <div className={`w-2 h-2 rounded-full animate-pulse ${status === 'clocked_in' ? 'bg-green-400' : 'bg-slate-600'}`}></div>
                                        {status === 'clocked_in' ? 'RECORDING TIME' : 'OFF DUTY'}
                                    </div>
                                </div>
                            </div>

                            <div className="p-8">
                                {error && (
                                    <div className="mb-8 p-5 bg-red-50 border-l-4 border-red-500 rounded-2xl flex items-start gap-4">
                                        <AlertCircle className="w-6 h-6 text-red-500 flex-shrink-0" />
                                        <div className="flex-1 text-red-900 font-medium text-sm">{error}</div>
                                    </div>
                                )}
                                <div className="grid grid-cols-1 sm:grid-cols-2 gap-6">
                                    <button disabled={status === 'clocked_in'} onClick={handleClockIn} className={`p-10 rounded-3xl border-2 transition-all flex flex-col items-center ${status === 'clocked_in' ? 'opacity-40 grayscale' : 'hover:border-green-500 hover:shadow-xl'}`}>
                                        <div className="p-5 rounded-3xl bg-green-50 text-green-600 mb-4"><LogIn className="w-10 h-10" /></div>
                                        <span className="font-black text-slate-800">Clock In</span>
                                    </button>
                                    <button disabled={status === 'idle' && logs.length === 0} onClick={handleClockOut} className={`p-10 rounded-3xl border-2 transition-all flex flex-col items-center ${status === 'idle' && logs.length === 0 ? 'opacity-40 grayscale' : 'hover:border-red-500 hover:shadow-xl'}`}>
                                        <div className="p-5 rounded-3xl bg-red-50 text-red-600 mb-4"><LogOut className="w-10 h-10" /></div>
                                        <span className="font-black text-slate-800">Clock Out</span>
                                    </button>
                                </div>
                            </div>
                        </div>

                        <div className="bg-white rounded-3xl border border-slate-200 shadow-sm overflow-hidden">
                            <button onClick={() => setShowHistory(!showHistory)} className="w-full p-6 flex items-center justify-between font-black text-slate-700 uppercase text-sm tracking-tighter">
                                <div className="flex items-center gap-3"><History className="w-5 h-5 text-orange-500" />Session Log</div>
                                <span className="text-[10px] text-slate-400 bg-slate-100 px-2 py-0.5 rounded">{logs.length} ENTRIES</span>
                            </button>
                            {showHistory && (
                                <div className="p-6 border-t border-slate-100 space-y-4 bg-slate-50/50">
                                    {logs.map((log, idx) => (
                                        <div key={idx} className="flex items-center justify-between p-4 rounded-2xl bg-white border border-slate-100 shadow-sm">
                                            <div className="flex items-center gap-4">
                                                <div className={`w-10 h-10 rounded-xl flex items-center justify-center ${log.type === 'IN' ? 'bg-green-50 text-green-600' : 'bg-red-50 text-red-600'}`}>
                                                    {log.type === 'IN' ? <CheckCircle2 className="w-5 h-5" /> : <LogOut className="w-5 h-5" />}
                                                </div>
                                                <div>
                                                    <p className="text-sm font-black text-slate-800 uppercase">Clocked {log.type}</p>
                                                    <p className="text-[10px] font-bold text-slate-400 uppercase">{log.date}</p>
                                                </div>
                                            </div>
                                            <p className="text-lg font-black text-slate-800 tracking-tighter tabular-nums">{log.time}</p>
                                        </div>
                                    ))}
                                </div>
                            )}
                        </div>
                    </div>
                </div>
            );
        };

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>
